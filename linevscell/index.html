
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.3.9">
    
    
      
        <title>SQL Magic Commands - Db2 Magic Commands</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,300i,400,400i,700,700i%7CIBM+Plex+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"IBM Plex Sans";--md-code-font:"IBM Plex Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="black">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sql-magic-commands" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Db2 Magic Commands" class="md-header__button md-logo" aria-label="Db2 Magic Commands" data-md-component="logo">
      
  <img src="../img/IBM_logo®_rev_RGB.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Db2 Magic Commands
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SQL Magic Commands
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Db2 Magic Commands" class="md-nav__button md-logo" aria-label="Db2 Magic Commands" data-md-component="logo">
      
  <img src="../img/IBM_logo®_rev_RGB.png" alt="logo">

    </a>
    Db2 Magic Commands
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../connect/" class="md-nav__link">
        Getting Connected
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          SQL Magic Commands
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        SQL Magic Commands
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#line-command-sql" class="md-nav__link">
    Line Command %sql
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cell-command-sql" class="md-nav__link">
    Cell Command %%sql
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-and-assignment-statements" class="md-nav__link">
    Output and Assignment Statements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multiple-result-sets" class="md-nav__link">
    Multiple Result Sets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python-versus-db2-character-strings" class="md-nav__link">
    Python versus Db2 Character Strings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#built-in-variables" class="md-nav__link">
    Built-in Variables
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../sql_options/" class="md-nav__link">
        SQL Options
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../command_options/" class="md-nav__link">
        Db2 Magic Command Options
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../plotting/" class="md-nav__link">
        Plotting
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../variables/" class="md-nav__link">
        Variables
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../resultsets/" class="md-nav__link">
        Result Sets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../stored_procedures/" class="md-nav__link">
        Stored Procedures
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../developmentsql/" class="md-nav__link">
        Development SQL
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../pandasdb2/" class="md-nav__link">
        Pandas to Db2
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../parallel/" class="md-nav__link">
        Parallel SQL
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../macros/" class="md-nav__link">
        Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../extramacros/" class="md-nav__link">
        Predefined Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../support/" class="md-nav__link">
        Support
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#line-command-sql" class="md-nav__link">
    Line Command %sql
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cell-command-sql" class="md-nav__link">
    Cell Command %%sql
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-and-assignment-statements" class="md-nav__link">
    Output and Assignment Statements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multiple-result-sets" class="md-nav__link">
    Multiple Result Sets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python-versus-db2-character-strings" class="md-nav__link">
    Python versus Db2 Character Strings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#built-in-variables" class="md-nav__link">
    Built-in Variables
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="sql-magic-commands">SQL Magic Commands</h1>
<p>The Db2 extension is made up of one magic command that works either at the LINE level (<code>%sql</code>) or at the CELL level (<code>%%sql</code>). Both versions of the <code>%sql</code> commands provide the ability to run Db2 SQL commands including:</p>
<ul>
<li>DCL - Setting permissions for database objects</li>
<li>DDL - Creating or dropping database objects</li>
<li>DML - Insert, update, delete, or select data from tables</li>
<li>Administration - A subset of administration commands using the <code>ADMIN_CMD</code> function</li>
</ul>
<p>The syntax of the <code>%sql</code> statement is:</p>
<pre><code>%sql -options sql 
</code></pre>
<p>The syntax for <code>%%sql</code> is:</p>
<pre><code>%%sql -options
sql 1
sql 2
...
</code></pre>
<p>The difference between the two <code>%sql</code> commands is that <code>%sql</code> only allows for a single statement to be executed, while the <code>%%sql</code> allows a block of SQL to be executed. </p>
<h2 id="line-command-sql">Line Command <code>%sql</code></h2>
<p>In a Jupyter notebook, a code cell can contain Python code and magic commands. You can use the single line version of the <code>%sql</code> command along with Python code in a cell:</p>
<p><img alt="Cell 1" src="../img/cell1.png" /></p>
<p>The entire SQL statement must be found after the <code>%sql</code> command. You can use two techniques to allow for larger SQL statements, but the major restriction is that only <strong>one</strong> SQL statement is executed.</p>
<p>To extend the SQL over multiple lines, use the Python <code>\</code> character as the last character of a string. This will allow you to continue the statement onto the next line:</p>
<p><img alt="Cell 2" src="../img/cell2.png" /></p>
<p><strong>Note:</strong> Make absolutely sure that there are <strong>no</strong> characters, even spaces, following the <code>\</code> character, otherwise the statement will be terminated at that point.</p>
<p>The other option is to create a Python variable that contains the SQL string using triple quotes (<code>'''</code>,<code>"""</code>). If you are using variable substitution in the string then you must remember to use the <code>f"""</code> qualifier at the beginning of the string to ensure the variable substitution is done.</p>
<p><img alt="Cell 3" src="../img/cell3.png" /></p>
<p>When using this technique to create the SQL statement, you do <strong>not</strong> need to use the continuation characters. This will simplify the creation of your SQL. </p>
<p>In summary, the single line version of the <code>%sql</code> command can run a single SQL statement and can also coexist with Python statements in the same code cell.</p>
<h2 id="cell-command-sql">Cell Command <code>%%sql</code></h2>
<p>If you want to run a large SQL statement, or multiple SQL statements, then you must use the <code>%%sql</code> command. Note that when you use the <code>%%sql</code> form of the command, the entire contents of the cell is considered part of the command, so you cannot mix Python statements in the cell.</p>
<p>The following is an example of using the <code>%%sql</code> command:</p>
<p><img alt="Cell 4" src="../img/cell4.png" /></p>
<p>The cell contains only the SQL statement and nothing else. The previous <code>%sql</code> examples combined Python and the magic command. A <code>%%sql</code> cell block can contain more than one SQL statement:</p>
<p><img alt="Cell 5" src="../img/cell5.png" /></p>
<p>If there is more than one SQL statement in the block, you must terminate each statement with a semicolon <code>;</code>. If you are creating stored procedures or functions, then you may need to change the delimiter to an at <code>@</code> sign by using the option <code>-d</code>.</p>
<pre><code>%%sql -d
DROP TABLE NEW_EMPLOYEE@
CREATE TABLE NEW_EMPLOYEE LIKE EMPLOYEE@
</code></pre>
<h2 id="output-and-assignment-statements">Output and Assignment Statements</h2>
<p>The <code>%sql</code> and <code>%%sql</code> commands will generate output when a <code>SELECT</code> statement produces results. Both of forms of the command will display the results as a Pandas dataframe.</p>
<p><img alt="Cell 6" src="../img/cell6.png" /></p>
<p>The <code>%sql</code> command provides the option of assigning the output to a Python variable:</p>
<pre><code>results = %sql SELECT * FROM DEPARTMENT
</code></pre>
<p>The <code>results</code> variable will contain the answer set as a Pandas dataframe. You can use the various Pandas functions to manipulate the dataframe including the ability to display certain portions of the data, do calculations across ranges, and plot the data. </p>
<p><img alt="Cell 7" src="../img/cell7.png" /></p>
<p>The ability to assign a result set to a Python variable is <strong>only</strong> available for the <code>%sql</code> command.</p>
<h2 id="multiple-result-sets">Multiple Result Sets</h2>
<p>When using the <code>%%sql</code> command, you could have multiple <code>SELECT</code> statements in your SQL:</p>
<pre><code>%%sql
SELECT * FROM EMPLOYEE;
SELECT * FROM DEPARTMENT;
</code></pre>
<p>It's not recommended that you do this because of the way the dataframes are displayed. By default, the Db2 magic commands will display the results in the Pandas dataframe format. When you execute the above code, you will only see one result set displayed:</p>
<p><img alt="Cell 8" src="../img/cell8.png" /></p>
<p>The first <code>SELECT</code> is the one that is always displayed. If you do want to see multiple result sets, you must use the <code>-grid</code> option and have the ipydatagrid extension installed. If you use the <code>-grid</code> option, then the two answer sets will be displayed.</p>
<p><img alt="Cell 9" src="../img/cell9.png" /></p>
<h2 id="python-versus-db2-character-strings">Python versus Db2 Character Strings</h2>
<p>Character strings require special handling when dealing with Db2. The single quote character <code>'</code> is reserved for delimiting string constants, while the double quote <code>"</code> is used for naming columns that require special characters. You cannot use the double quote character to delimit strings that happen to contain the single quote character. What Db2 requires for single quotes in a string is to place two quotes in a row to have them interpreted as a single quote character. For instance, the next statement will select one employee from the table who has a quote in their last name: <code>O'CONNELL</code>.</p>
<pre><code>%sql SELECT * FROM EMPLOYEE WHERE LASTNAME = 'O''CONNELL'
</code></pre>
<p>Python handles quotes differently! You can assign a string to a Python variable using single or double quotes. The following assignment statements are not identical!</p>
<p><img alt="Quotes" src="../img/cell10.png" /></p>
<p>If you use the same syntax as Db2, Python will remove the quote in the string! It interprets this as two strings (<code>O</code> and <code>CONNELL</code>) being concatenated together. That probably isn't what you want! So the safest approach is to use double quotes around your string when you assign it to a variable. Then you can use the variable in the SQL statement as shown in the following example.</p>
<p><img alt="Quotes" src="../img/cell11.png" /></p>
<p>Notice how the string constant was updated to contain two quotes when inserted into the SQL statement. This is done automatically by the <code>%sql</code> magic command, so there is no need to use the two single quotes when assigning a string to a variable. However, you must use the two single quotes when using constants in a SQL statement. </p>
<h2 id="built-in-variables">Built-in Variables</h2>
<p>There are four built-in variables that you have access to in your code cells. These pre-defined variables are:</p>
<ul>
<li><code>sqlcode</code> - The <code>SQLCODE</code> returned by the last statement executed</li>
<li><code>sqlstate</code> - The <code>SQLSTATE</code> returned by the last statement executed</li>
<li><code>sqlelapsed</code> - The time taken to execute the last statement</li>
<li><code>sqlerror</code> - The error message associated with the <code>sqlcode</code> value</li>
</ul>
<p>Normally these variables are used for application development, but you may find the <code>sqlelapsed</code> useful for timing SQL statements.</p>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../connect/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Getting Connected" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Getting Connected
            </div>
          </div>
        </a>
      
      
        
        <a href="../sql_options/" class="md-footer__link md-footer__link--next" aria-label="Next: SQL Options" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              SQL Options
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 IBM
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
    
  </body>
</html>