
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.3.9">
    
    
      
        <title>Pandas to Db2 - Db2 Magic Commands</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,300i,400,400i,700,700i%7CIBM+Plex+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"IBM Plex Sans";--md-code-font:"IBM Plex Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="black">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pandas-to-db2" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Db2 Magic Commands" class="md-header__button md-logo" aria-label="Db2 Magic Commands" data-md-component="logo">
      
  <img src="../img/IBM_logo®_rev_RGB.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Db2 Magic Commands
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Pandas to Db2
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Db2 Magic Commands" class="md-nav__button md-logo" aria-label="Db2 Magic Commands" data-md-component="logo">
      
  <img src="../img/IBM_logo®_rev_RGB.png" alt="logo">

    </a>
    Db2 Magic Commands
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../connect/" class="md-nav__link">
        Getting Connected
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../linevscell/" class="md-nav__link">
        SQL Magic Commands
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../sql_options/" class="md-nav__link">
        SQL Options
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../command_options/" class="md-nav__link">
        Db2 Magic Command Options
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../plotting/" class="md-nav__link">
        Plotting
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../variables/" class="md-nav__link">
        Variables
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../resultsets/" class="md-nav__link">
        Result Sets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../stored_procedures/" class="md-nav__link">
        Stored Procedures
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../developmentsql/" class="md-nav__link">
        Development SQL
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../pandasdb2/" class="md-nav__link">
        Pandas to Db2
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../parallel/" class="md-nav__link">
        Parallel SQL
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../macros/" class="md-nav__link">
        Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../extramacros/" class="md-nav__link">
        Predefined Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../support/" class="md-nav__link">
        Support
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-replace-or-append-a-table" class="md-nav__link">
    Create, Replace, or Append a Table
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#options" class="md-nav__link">
    Options
  </a>
  
    <nav class="md-nav" aria-label="Options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#with-data" class="md-nav__link">
    With Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limit-x" class="md-nav__link">
    LIMIT x
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#columns-asis" class="md-nav__link">
    COLUMNS ASIS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keep-float64-int64" class="md-nav__link">
    KEEP FLOAT64, INT64
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#format-specification" class="md-nav__link">
    Format Specification
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="pandas-to-db2">Pandas to Db2</h1>
<p>The primary purpose of the <code>%sql</code> command was to allow easy access to Db2 data from within a Jupyter notebook. However, there are situations where you may want to take the contents of a Pandas dataframe and move that into a Db2 table. There are multiple steps required to move the data from a dataframe to Db2 including:</p>
<ul>
<li>Determining the columns required, including the data types associated with them</li>
<li>Creating the Table</li>
<li>Inserting the contents of the dataframe into the table</li>
</ul>
<p>In order to simplify the process of saving dataframe information, an extension to the SQL syntax has been added within the Db2 magic commands. The <code>USING</code> keyword in a SQL statement is used to trigger special handling of a dataframe. The syntax of the <code>USING</code> command is:</p>
<pre><code>USING dataframe [CREATE | REPLACE | APPEND | DECLARE] TABLE &lt;name&gt; options 
</code></pre>
<p>The purpose of the <code>USING</code> command is to create a table based on the dataframe definition, and optionally insert the data into the table. There are additional options which determine how the table is created and whether data is loaded into the table. </p>
<p>The <code>dataframe</code> value refers to the Python variable that contains the dataframe contents. Do not use the SQL variable format <code>:dataframe</code> or Python value substitution <code>{dataframe}</code> in the statement.</p>
<h2 id="create-replace-or-append-a-table">Create, Replace, or Append a Table</h2>
<p>The <code>USING</code> command has three different modes of operation:</p>
<ul>
<li><code>CREATE</code> - Create the table based on the dataframe contents</li>
<li><code>REPLACE</code> - Recreate the table (delete the old one) based on the dataframe contents</li>
<li><code>APPEND</code> - Use the existing table definition and update the contents </li>
<li><code>DECLARE</code> - Print the table definition only</li>
</ul>
<p>After each one of these modes you must specify the name of the table. The table can be qualified with a SCHEMA name:</p>
<pre><code>%sql USING df CREATE TABLE db2inst1.flights ...
</code></pre>
<p>If no options are found after the mode (<code>CREATE</code>,<code>REPLACE</code>), a table will be created with the dataframe column definitions:</p>
<p><img alt="Pandas" src="../img/pddb21.png" /></p>
<p>The definition of the table is displayed underneath the command. If you believe that different data types should be used for the columns, then you can copy the command into another cell and recreate the table with the proper settings.</p>
<p>An error message will be displayed if you use the <code>CREATE</code> statement and the table already exists in the system.</p>
<p><img alt="Pandas" src="../img/pderror.png" /></p>
<p>In this case you should use the <code>REPLACE</code> option which will recreate the table for you. </p>
<p>The <code>APPEND</code> mode will fail if the table has not been created. The best practice is to <code>CREATE</code> or <code>REPLACE</code> the table first and then use <code>APPEND</code>.</p>
<p><img alt="Pandas" src="../img/appendfail.png" /></p>
<p>If the table does exist, <code>APPEND</code> will insert the data from the dataframe into the new table.</p>
<h2 id="options">Options</h2>
<p>There are five options that can be specified after the mode:</p>
<ul>
<li><code>WITH DATA</code> - Create the table and insert the data from the dataframe</li>
<li><code>LIMIT x</code> - Limit the amount of data loaded to <code>x</code> rows</li>
<li><code>COLUMNS ASIS</code> - Keep the column names as found in the dataframe instead of Db2-friendly names</li>
<li><code>KEEP FLOAT64</code> - Keep all float64 dataframe columns as is</li>
<li><code>KEEP INT64</code> - Keep all int64 dataframe columns as is</li>
<li><code>FORMAT SPEC</code> - See below for column formatting options</li>
</ul>
<h3 id="with-data">With Data</h3>
<p>With the <code>CREATE</code> and <code>REPLACE</code> modes, the table will be created, but no data will be inserted in the table. The <code>APPEND</code> mode assumes that you do want the data inserted so it does not require this option. When you specify the <code>WITH DATA</code> option, after creating the table the system will insert the data from the dataframe into the Db2 table.</p>
<p>When data is being loaded into the table, a progress indicator will appear underneath the table definition giving an indication of how many rows have been inserted into the table.</p>
<p><img alt="DF Create" src="../img/progress.png" /></p>
<h3 id="limit-x">LIMIT x</h3>
<p>The <code>WITH DATA</code> option will tell the system to insert the data from the dataframe into the Db2 table. The <code>LIMIT x</code> option will stop the inserts after <code>x</code> number of rows. This may be useful if you only want to store a subset of data into the Db2 table, or if you want to make sure that the data is being properly inserted into the table. You can always test the insert process by using the following steps:</p>
<p><img alt="DF Create" src="../img/dfcreate.png" /></p>
<h3 id="columns-asis">COLUMNS ASIS</h3>
<p>When the system attempts to create the Db2 table, it takes the column names in the dataframe and makes them Db2 compatible. This means that special characters and blanks are removed from the name and replaced with underscores. In addition, the names are converted to uppercase so that SQL statements do not have to delimit column names with double quotes <code>"</code>. </p>
<p>The SQL standard allows column names to contain special characters, as long as they are delimited with double quotes. If a column name uses standard characters <code>A-Z,0-9,_</code>, then no quotes are required around the column name. There is also no need to worry about the case of the column names since all names will be folded to uppercase. </p>
<p>The conversion of column names can be seen in the <code>flights.csv</code> data set. The columns in this CSV file are named:</p>
<p><img alt="DF Create" src="../img/dfcolumns.png" /></p>
<p>During the conversion process, the columns are renamed:</p>
<p><img alt="DF Create" src="../img/columnnames.png" /></p>
<p>The most notable change is the conversion of blanks to underscore <code>_</code> characters. If you do <strong>not</strong> want this conversion to occur, and keep the column names in their original format, use the <code>COLUMNS ASIS</code> option. This will cause the program to create the table with the exact column names of the dataframe without any changes. The <code>CREATE</code> example below illustrates how the column names are kept the same.</p>
<p><img alt="DF Create" src="../img/columnsasis.png" /></p>
<p>Note that this will make creating SQL queries slightly more challenging! If you want to query the flights per annum field, you will need to make sure you place the column name in quotes and have the correct spelling:</p>
<pre><code>%%sql
SELECT * FROM MYFLIGHTS
  WHERE &quot;Flights p.a.&quot; &gt; 10
</code></pre>
<h3 id="keep-float64-int64">KEEP FLOAT64, INT64</h3>
<p>Pandas will often convert data into types that are larger than what is required. A good example of this is when a column with decimal or numeric values gets the data converted to float! The sample <code>EMPLOYEE</code> table illustrates this problem. A <code>DESCRIBE</code> of the <code>EMPLOYEE</code> table shows that the <code>SALARY</code> column is decimal.</p>
<p><img alt="DF Create" src="../img/describeemployee.png" /></p>
<p>When the dataframe is created from the <code>SELECT</code> statement, the data type for the <code>SALARY</code> column is <code>float64</code>.</p>
<p><img alt="DF Create" src="../img/float.png" /></p>
<p>When a table is created from this dataframe, the default behavior is to create a datatype that is closer to the values in the column. In this case the data is converted to <code>DECFLOAT</code> which is more suited to decimal numbers.</p>
<p><img alt="DF Create" src="../img/decfloat.png" /></p>
<p>If you do not want <code>float64</code> or <code>int64</code> values to be converted to smaller datatypes, you must use the <code>KEEP FLOAT64</code> and/or <code>KEEP INT64</code> to keep the original values.</p>
<pre><code>%sql USING employee CREATE TABLE NEW_EMPLOYEE KEEP FLOAT64 KEEP INT64
</code></pre>
<h3 id="format-specification">Format Specification</h3>
<p>You can change how the program creates columns by specifying a formatting option. The format options are:</p>
<ul>
<li>INTTYPE - SMALLINT, INT, BIGINT</li>
</ul>
<p>For any integer column, use SMALLINT, INT, or BIGINT</p>
<ul>
<li>CHARTYPE - CHAR, VARCHAR, NVARCHAR, VARGRAPHIC</li>
</ul>
<p>For any character column, use VARCHAR, NVARCHAR, VARGRAPHIC, or CHAR. Note that the value after the type (i.e., the "x" in VARCHAR(x)) is computed by the program.</p>
<ul>
<li>CLOBTYPE - CLOB, CLOB(x), VARCHAR(x)</li>
</ul>
<p>For a CLOBTYPE, you must provide a length when using VARCHAR and optionally for CLOB.</p>
<ul>
<li>BLOBTYPE - BLOB, BLOB(x), VARBINARY(x)</li>
</ul>
<p>For a BLOBTYPE, you must provide a length when using VARBINARY and optionally for BLOB.</p>
<ul>
<li>FLOATTYPE - FLOAT, REAL, NUMERIC, DECIMAL(x,y)</li>
</ul>
<p>For a floating point number you can use any of the options above. For DECIMAL, you must specify the length and scale (x,y).</p>
<ul>
<li>PADDING multiplier</li>
</ul>
<p>The padding multiplier is used with all character columns. The multiplier will pad the character definition by the amount specified after the PADDING keyword. For instance, PADDING 1.5 on CHAR(10) will result in a CHAR(15) definition. </p>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 IBM
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
    
  </body>
</html>